---
import "../styles/footer.css";

const year = new Date().getFullYear();
---

<footer class="footer">
  <div class="footerInner">
    <div class="footerLeft">
      <div class="footerTitle">Select your Theme!</div>

      <div class="themeBar">
        <button
          class="modeBtn"
          type="button"
          aria-label="Toggle light or dark mode"
          data-tooltip="Toggle Light or Dark"
        >
          <img
            class="modeIcon"
            src="/assets/icons/ui/mode/sun.png"
            alt="Mode"
            width="24"
            height="24"
            decoding="async"
          />
        </button>

        <div class="themeSpacer"></div>

        <div class="themeRow" aria-label="Theme selection">
          <button class="themeHead" type="button" data-theme="blue" aria-label="Blue theme" data-tooltip="Marco's pick: Blue">
            <img src="/assets/icons/ui/blue.png" alt="Blue" width="28" height="28" decoding="async" />
          </button>

          <button class="themeHead" type="button" data-theme="gold" aria-label="Gold theme" data-tooltip="CR loves: Gold">
            <img src="/assets/icons/ui/gold.png" alt="Gold" width="28" height="28" decoding="async" />
          </button>

          <button class="themeHead" type="button" data-theme="pink" aria-label="Pink theme" data-tooltip="MissLilitus chose: Pink">
            <img src="/assets/icons/ui/pink.png" alt="Pink" width="28" height="28" decoding="async" />
          </button>

          <button class="themeHead" type="button" data-theme="neon" aria-label="Tsuyumori: Particle Party" data-tooltip="Tsuyumori: High-energy neon madness">
            <img src="/assets/icons/ui/neon.png" alt="Neon" width="28" height="28" decoding="async" />
          </button>

          <button class="themeHead" type="button" data-theme="green" aria-label="Green theme" data-tooltip="Lunar's chaos: Toxic Green">
            <img src="/assets/icons/ui/green.png" alt="Green" width="28" height="28" decoding="async" />
          </button>
        </div>
      </div>
    </div>

    <div class="footerText">
      Copyright {year} Â© satisfy<br />
      Let's Do is not affiliated with Mojang Studios
    </div>

    <div class="footerRight" aria-label="Social links">
      <a class="socialLink" href="https://github.com/Let-s-Do-Collection/Let-s-Do-Collection" target="_blank" rel="noopener noreferrer" aria-label="GitHub" data-tooltip="Source code & issues">
        <img class="socialIcon" src="/assets/icons/ui/github.png" alt="GitHub" width="26" height="26" decoding="async" loading="lazy" />
      </a>

      <a class="socialLink" href="https://discord.gg/Jb2bgpYr" target="_blank" rel="noopener noreferrer" aria-label="Discord" data-tooltip="Join the community">
        <img class="socialIcon" src="/assets/icons/ui/discord.png" alt="Discord" width="26" height="26" decoding="async" loading="lazy" />
      </a>

      <a class="socialLink" href="https://www.patreon.com/c/u78595058" target="_blank" rel="noopener noreferrer" aria-label="Patreon" data-tooltip="Support development">
        <img class="socialIcon" src="/assets/icons/ui/patreon.png" alt="Patreon" width="26" height="26" decoding="async" loading="lazy" />
      </a>
    </div>
  </div>

  <script is:inline>
    const root = document.documentElement
    const themes = new Set(['blue', 'gold', 'pink', 'green', 'neon'])

    function normalizeTheme(value) {
      return themes.has(value) ? value : 'blue'
    }

    function normalizeMode(value) {
      return value === 'dark' ? 'dark' : 'light'
    }

    function setDataset(theme, mode) {
      root.setAttribute('data-theme', theme)
      root.setAttribute('data-mode', mode)
    }

    function setStored(theme, mode) {
      localStorage.setItem('theme', theme)
      localStorage.setItem('mode', mode)
    }

    function getSaved() {
      const savedTheme = normalizeTheme(localStorage.getItem('theme'))
      const savedMode = normalizeMode(localStorage.getItem('mode'))
      return { savedTheme, savedMode }
    }

    function setModeIcon(modeIcon, mode) {
      modeIcon.src = mode === 'dark'
        ? '/assets/icons/ui/mode/moon.png'
        : '/assets/icons/ui/mode/sun.png'
    }

    const { savedTheme, savedMode } = getSaved()
    setDataset(savedTheme, savedMode)

    const runIdle = (fn) => {
      if ('requestIdleCallback' in window) {
        window.requestIdleCallback(fn, { timeout: 1200 })
      } else {
        window.setTimeout(fn, 1)
      }
    }

    runIdle(() => {
      const modeButton = document.querySelector('.modeBtn')
      const modeIcon = document.querySelector('.modeIcon')
      const themeButtons = document.querySelectorAll('.themeHead[data-theme]')
      const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches

      function triggerThemeTransitionFromRect(rect) {
        if (reduceMotion) return
        root.style.setProperty('--theme-x', (rect.left + rect.width / 2) + 'px')
        root.style.setProperty('--theme-y', (rect.top + rect.height / 2) + 'px')
        root.classList.add('themeTransition')
        window.setTimeout(() => root.classList.remove('themeTransition'), 260)
      }

      function beginModeTransition() {
        if (reduceMotion) return
        root.style.setProperty('--mode-fade', 'rgba(0,0,0,0.45)')
        root.classList.add('modeTransition')
      }

      function softenModeTransitionForLight() {
        if (reduceMotion) return
        root.style.setProperty('--mode-fade', 'rgba(0,0,0,0.18)')
      }

      function endModeTransition(delay) {
        if (reduceMotion) return
        window.setTimeout(() => root.classList.remove('modeTransition'), delay)
      }

      function apply(theme, mode) {
        setDataset(theme, mode)
        setStored(theme, mode)
        setModeIcon(modeIcon, mode)
      }

      setModeIcon(modeIcon, normalizeMode(root.getAttribute('data-mode')))

      themeButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const rect = btn.getBoundingClientRect()
          triggerThemeTransitionFromRect(rect)
          const theme = normalizeTheme(btn.dataset.theme)
          const mode = normalizeMode(root.getAttribute('data-mode'))
          apply(theme, mode)
        })
      })

      modeButton.addEventListener('click', async () => {
        const theme = normalizeTheme(root.getAttribute('data-theme'))
        const currentMode = normalizeMode(root.getAttribute('data-mode'))
        const nextMode = currentMode === 'dark' ? 'light' : 'dark'

        beginModeTransition()

        await new Promise((r) => window.setTimeout(r, 170))

        apply(theme, nextMode)

        if (nextMode === 'light') {
          window.setTimeout(() => softenModeTransitionForLight(), 70)
          endModeTransition(220)
        } else {
          endModeTransition(140)
        }
      })
    })
  </script>
</footer>